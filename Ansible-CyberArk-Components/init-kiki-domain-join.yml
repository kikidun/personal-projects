---
 - name: Join Target windows servers to the kiki.lab domain
   hosts: windows-servers
   tasks:
    - name: Check if the machine is already domain joined
      win_domain_membership:
        dns_domain_name: kiki.lab
        domain_admin_user: Administrator@kiki.lab
        domain_admin_password: Cyberark2@
        #domain_ou_path: "OU=Computers,DC=kiki,DC=lab"
        state: domain
      register: domain_state
      
    - win_reboot:
      when: domain_state.reboot_required  
    
